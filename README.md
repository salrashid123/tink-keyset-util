## Tink Keyset Key Utility 

Utility function to extract or _export_ the embedded AES, RSA, ECC or HMAC key inside a [tink-crypto](https://github.com/tink-crypto) cleartext or encrypted keyset.  

You can also use this library to _import_ an external key into a tink keyset.

This repo also also allows for a way to _remove the prefix_ added by Tink to most ciphertext data generated by Tink.

Using both these functions will allow you to encrypt or sign some data with Tink and use off the shelf libraries to decrypt/verify later.

Basically, this is a way to remove the extra bits tink uses to make off-the-shelf compatibility a bit less challenging.

This repo is a generic implementation of  [Importing and extracting external keys for BigQuery AEAD Tink KeySets](https://github.com/salrashid123/bq_aead_key)


See the examples folder for a full end-to-end tests where  you

1. generate a TINK key
2. `export`: extract the embedded true raw key material from (1)
3. encrypt/sign/hmac some data using tink
4. decrypt/verify the same data using the raw extracted key
5. `import`: create a tink keyset using the _raw_ extracted key
6. compare the original tink keyset in 1 with the regenerted keyset in 5

Notice that in the examples below, the keyset created by tink is regenerated from the _raw_ extracted key.  

Furthermore, the `examples/` folder demonstrates using tink raw mode to encrypt/sign data can be decrypted or verified by the exported raw key.  See the `end-to-end` section below.

>> this library is **NOT** supported by google; its unreviewed

---

* [Export](#export)
  - [AES](#aes-export)
  - [HMAC](#hmac-export)
  - [RSA](#rsa-export)
  - [ECC](#ecc-export)
  - [Encrypted Keyset](#encrypted-keyset-export)
* [Import](#import)
  - [AES](#aes-import)
  - [HMAC](#hmac-import)
  - [RSA](#rsa-import)
  - [ECC](#ecc-import)
* [Encrypted Keyset](#encrypted-keyset-import)
* [Extract CipherText](#extract-ciphertext)
* [Library Import Functions](#library-import-functions)
* [Library Export Functions](#library-export-functions)

The following examples uses [tinkkey](https://developers.google.com/tink/tinkey-overview) to genreate and convert key formats

---

### Export

If you have an existing keyset, you can _extract_ the raw encryption or asymmetirc keys

##### AES Export

To _extract_ the raw aes key from a keyset

```bash
### create a keyset and key for aes_gcm  and also convert to json keyset
tinkey create-keyset --key-template=AES256_GCM --out-format=binary --out=/tmp/aes_gcm_1.bin
tinkey convert-keyset --in-format=binary --in=/tmp/aes_gcm_1.bin --out-format=json --out=/tmp/aes_gcm_1.json

# list the keyset
tinkey list-keyset --in-format=json --in=/tmp/aes_gcm_1.json 
		primary_key_id: 1243030928
		key_info {
  			type_url: "type.googleapis.com/google.crypto.tink.AesGcmKey"
  			status: ENABLED
  			key_id: 1243030928
  			output_prefix_type: TINK
		}
### now extract the raw aes key

go run aes_gcm/export/insecurekeyset/main.go -insecure-key-set /tmp/aes_gcm_1.bin 
	Raw key: 5OGmcXC2vd1cdch6KtJ7gkoBXrhSpTBN/ghfvuOlCAQ=

# or for jsonkeyset
# go run aes_gcm/export/insecurejsonkeyset/main.go -insecure-key-set /tmp/aes_gcm_1.json
```

##### HMAC Export

To _extract_ the raw hmac key from a keyset

```bash
### create a keyset with an hmac key
tinkey create-keyset --key-template=HMAC_SHA256_256BITTAG --out-format=binary --out=/tmp/hmac_bittag.bin
tinkey convert-keyset --in-format=binary --in=/tmp/hmac_bittag.bin --out-format=json --out=/tmp/hmac_bittag.json

cat /tmp/hmac_bittag.json

{
  "primaryKeyId": 524026892,
  "key": [
    {
      "keyData": {
        "typeUrl": "type.googleapis.com/google.crypto.tink.HmacKey",
        "value": "EgQIAxAgGiAVkj5h5yh88DBf2VND8wRW5ctRTqNnQgWkB9+VAQfpHQ==",
        "keyMaterialType": "SYMMETRIC"
      },
      "status": "ENABLED",
      "keyId": 524026892,
      "outputPrefixType": "TINK"
    }
  ]
}

# now export
go run hmac/export/main.go --insecure-key-set /tmp/hmac_bittag.bin
	rawKey key: FZI+YecofPAwX9lTQ/MEVuXLUU6jZ0IFpAfflQEH6R0=
```

##### RSA Export

For RSA keys, you can export both the public and private keys (signer and verifier)


```bash
## create a keyset and extract the public key

tinkey create-keyset --key-template=RSA_SSA_PKCS1_3072_SHA256_F4 --out-format=binary --out=/tmp/rsa_1_private.bin
tinkey convert-keyset --in-format=binary --in=/tmp/rsa_1_private.bin --out-format=json --out=/tmp/rsa_1_private.json

tinkey create-public-keyset --in=/tmp/rsa_1_private.bin  --in-format=binary --out-format=binary --out=/tmp/rsa_1_public.bin
tinkey convert-keyset --in-format=binary --in=/tmp/rsa_1_public.bin --out-format=json --out=/tmp/rsa_1_public.json

$ cat /tmp/rsa_1_public.json | jq '.'

{
  "primaryKeyId": 3914250521,
  "key": [
    {
      "keyData": {
        "typeUrl": "type.googleapis.com/google.crypto.tink.RsaSsaPkcs1PublicKey",
        "value": "EgIIAxqBAwDUyhmQPBOHNd8wOhDB4dDrqnRn9hNH7RyiOnHwTwY5TMj2yVHdA2VT2Tru8v0DviNZBuJhUuXJdXfpy3xkInBsvfNBmGLwCrrBXjeyldAsSGLHbLgjxunuYd6sTpazyp8ZYUqHrtaD0zm58wjSnXFpbZMwr7DMZafwnJx1Js3UnvnfbALejBEodjdmEZrvrAcFfyQ05KjNeZnVx4cFG3Kw8i+XKzgdgnsnpTR0prDarfGiymZpXhAK+NtRQCJ3a7TMIXsWrEbrIUCzruectGy3hcOkbJ5AJvqFnMTiKqzHHwyNr9d/T+I/5D1TOw1XbutgwkeXRU+qu/oc8Mp7rzIJw6a/Vtczuwf1PzVhwPnLFNVSTyk0a8TeE1aNeIeg8ON4hGG5sXlEpzAWvL60arx5zq1o262qblNq/tJBbAMx1qei5CdVq/tg8xvduX4wyJ2zHxKCU3qILqbodumt12W4sKq3iStJaRQPg/tLaQQYPFHZbgAc1dkuKfrO1LC0m80iAwEAAQ==",
        "keyMaterialType": "ASYMMETRIC_PUBLIC"
      },
      "status": "ENABLED",
      "keyId": 3914250521,
      "outputPrefixType": "TINK"
    }
  ]
}

$ cat /tmp/rsa_1_private.json  | jq '.'

{
  "primaryKeyId": 3914250521,
  "key": [
    {
      "keyData": {
        "typeUrl": "type.googleapis.com/google.crypto.tink.RsaSsaPkcs1PrivateKey",
        "value": "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",
        "keyMaterialType": "ASYMMETRIC_PRIVATE"
      },
      "status": "ENABLED",
      "keyId": 3914250521,
      "outputPrefixType": "TINK"
    }
  ]
}

#### now export the public key

$ go run rsa/export/main.go --insecure-key-set /tmp/rsa_1_public.bin --pubout /tmp/rsa_1_public.pem

-----BEGIN RSA PUBLIC KEY-----
MIIBigKCAYEA1MoZkDwThzXfMDoQweHQ66p0Z/YTR+0cojpx8E8GOUzI9slR3QNl
U9k67vL9A74jWQbiYVLlyXV36ct8ZCJwbL3zQZhi8Aq6wV43spXQLEhix2y4I8bp
7mHerE6Ws8qfGWFKh67Wg9M5ufMI0p1xaW2TMK+wzGWn8JycdSbN1J7532wC3owR
KHY3ZhGa76wHBX8kNOSozXmZ1ceHBRtysPIvlys4HYJ7J6U0dKaw2q3xospmaV4Q
CvjbUUAid2u0zCF7FqxG6yFAs67nnLRst4XDpGyeQCb6hZzE4iqsxx8Mja/Xf0/i
P+Q9UzsNV27rYMJHl0VPqrv6HPDKe68yCcOmv1bXM7sH9T81YcD5yxTVUk8pNGvE
3hNWjXiHoPDjeIRhubF5RKcwFry+tGq8ec6taNutqm5Tav7SQWwDMdanouQnVav7
YPMb3bl+MMidsx8SglN6iC6m6HbprddluLCqt4krSWkUD4P7S2kEGDxR2W4AHNXZ
Lin6ztSwtJvNAgMBAAE=
-----END RSA PUBLIC KEY-----



#### then export the private key

$ go run rsa/export/main.go --insecure-key-set /tmp/rsa_1_private.bin --privout /tmp/rsa_1_private.pem

-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----
```

##### ECC Export

For an ECC keypair

```bash
### create a keypair
tinkey create-keyset --key-template=ECDSA_P256 --out-format=binary --out=/tmp/ecc_1_private.bin
tinkey convert-keyset --in-format=binary --in=/tmp/ecc_1_private.bin --out-format=json --out=/tmp/ecc_1_private.json

tinkey create-public-keyset --in=/tmp/ecc_1_private.bin  --in-format=binary --out-format=binary --out=/tmp/ecc_1_public.bin
tinkey convert-keyset --in-format=binary --in=/tmp/ecc_1_public.bin --out-format=json --out=/tmp/ecc_1_public.json

### print the keysets
$ cat /tmp/ecc_1_public.json | jq '.'
{
  "primaryKeyId": 2547454172,
  "key": [
    {
      "keyData": {
        "typeUrl": "type.googleapis.com/google.crypto.tink.EcdsaPublicKey",
        "value": "EgYIAxACGAIaIQAqJE1TqcfKrn3Es/eCQdalJSFIx9HJTxycMNpcYkUNZyIhAELaPVNbaDccW5TMimhArf6Sx2YBGLP72zHdinhne9gV",
        "keyMaterialType": "ASYMMETRIC_PUBLIC"
      },
      "status": "ENABLED",
      "keyId": 2547454172,
      "outputPrefixType": "TINK"
    }
  ]
}

$ cat /tmp/ecc_1_private.json | jq '.'
{
  "primaryKeyId": 2547454172,
  "key": [
    {
      "keyData": {
        "typeUrl": "type.googleapis.com/google.crypto.tink.EcdsaPrivateKey",
        "value": "Ek4SBggDEAIYAhohACokTVOpx8qufcSz94JB1qUlIUjH0clPHJww2lxiRQ1nIiEAQto9U1toNxxblMyKaECt/pLHZgEYs/vbMd2KeGd72BUaIQAheR1xK57P0TVda5F2SSgfISoXegEH/vUm8UePBmixdg==",
        "keyMaterialType": "ASYMMETRIC_PRIVATE"
      },
      "status": "ENABLED",
      "keyId": 2547454172,
      "outputPrefixType": "TINK"
    }
  ]
}

### now extract the two keys

$ go run ecc/export/main.go --insecure-key-set /tmp/ecc_1_public.bin 
-----BEGIN PUBLIC KEY-----
MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEKiRNU6nHyq59xLP3gkHWpSUhSMfR
yU8cnDDaXGJFDWdC2j1TW2g3HFuUzIpoQK3+ksdmARiz+9sx3Yp4Z3vYFQ==
-----END PUBLIC KEY-----


$ go run ecc/export/main.go --insecure-key-set /tmp/ecc_1_private.bin 
-----BEGIN EC PRIVATE KEY-----
MHcCAQEEICF5HXErns/RNV1rkXZJKB8hKhd6AQf+9SbxR48GaLF2oAoGCCqGSM49
AwEHoUQDQgAEU21Y/Nnr5Y6efBlhiH7g2W75V5HqpUvD2QO4idiWdpp/Hu0SZNqV
8DlkIgENts0ixufSVK73QWLvzFeyT3USlg==
-----END EC PRIVATE KEY-----
```

---

### Import

If you have an existing raw key, you can _import_ that into a keyset

##### AES Import

The follwing will generate a keyset using a raw AES key

```bash
$ go run aes_gcm/import/insecurekeyset/main.go  --key="ihsyzwyF2bbcqX2BPw1VLwh07Y9wVShz8YDffXEeAso="

{
 "primaryKeyId": 4112199248,
 "key": [
  {
   "keyData": {
    "typeUrl": "type.googleapis.com/google.crypto.tink.AesGcmKey",
    "value": "GiCKGzLPDIXZttypfYE/DVUvCHTtj3BVKHPxgN99cR4Cyg==",
    "keyMaterialType": "SYMMETRIC"
   },
   "status": "ENABLED",
   "keyId": 4112199248,
   "outputPrefixType": "TINK"
  }
 ]
}
``` 

##### HMAC Import

The follwing will generate a keyset using a raw HMAC key

```bash
$ go run hmac/import/main.go --key="YLb3il0JB06o46+iZOUFi/v4oveyc8ma7u0BqufYO/4="

{
  "primaryKeyId": 4112199248,
  "key": [
    {
      "keyData": {
        "typeUrl": "type.googleapis.com/google.crypto.tink.HmacKey",
        "value": "EgQIAxAgGiBgtveKXQkHTqjjr6Jk5QWL+/ii97JzyZru7QGq59g7/g==",
        "keyMaterialType": "SYMMETRIC"
      },
      "status": "ENABLED",
      "keyId": 4112199248,
      "outputPrefixType": "TINK"
    }
  ]
}
```

##### RSA Import

The follwing will generate a keyset using a raw public/private keys

usign the same two raw keys from the 'export' section `/tmp/rsa_1_public.pem`, `/tmp/rsa_1_private.pem`

```bash
$ go run rsa/import/public/main.go -keyFile /tmp/rsa_1_public.pem --keyout=/tmp/rsa_2_public.json
 {
  "primaryKeyId": 4198955199,
  "key": [
    {
      "keyData": {
        "typeUrl": "type.googleapis.com/google.crypto.tink.RsaSsaPkcs1PublicKey",
        "value": "EgIIAxqBAwDUyhmQPBOHNd8wOhDB4dDrqnRn9hNH7RyiOnHwTwY5TMj2yVHdA2VT2Tru8v0DviNZBuJhUuXJdXfpy3xkInBsvfNBmGLwCrrBXjeyldAsSGLHbLgjxunuYd6sTpazyp8ZYUqHrtaD0zm58wjSnXFpbZMwr7DMZafwnJx1Js3UnvnfbALejBEodjdmEZrvrAcFfyQ05KjNeZnVx4cFG3Kw8i+XKzgdgnsnpTR0prDarfGiymZpXhAK+NtRQCJ3a7TMIXsWrEbrIUCzruectGy3hcOkbJ5AJvqFnMTiKqzHHwyNr9d/T+I/5D1TOw1XbutgwkeXRU+qu/oc8Mp7rzIJw6a/Vtczuwf1PzVhwPnLFNVSTyk0a8TeE1aNeIeg8ON4hGG5sXlEpzAWvL60arx5zq1o262qblNq/tJBbAMx1qei5CdVq/tg8xvduX4wyJ2zHxKCU3qILqbodumt12W4sKq3iStJaRQPg/tLaQQYPFHZbgAc1dkuKfrO1LC0m80iAwEAAQ==",
        "keyMaterialType": "ASYMMETRIC_PUBLIC"
      },
      "status": "ENABLED",
      "keyId": 4198955199,
      "outputPrefixType": "TINK"
    }
  ]
}

$ go run rsa/import/private/main.go -keyFile /tmp/rsa_1_private.pem --prefix=raw --keyout=/tmp/rsa_2_private.json

{
  "primaryKeyId": 4198955199,
  "key": [
    {
      "keyData": {
        "typeUrl": "type.googleapis.com/google.crypto.tink.RsaSsaPkcs1PrivateKey",
        "value": "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",
        "keyMaterialType": "ASYMMETRIC_PRIVATE"
      },
      "status": "ENABLED",
      "keyId": 4198955199,
      "outputPrefixType": "RAW"
    }
  ]
}
```

##### ECC Import

The follwing will generate a keyset using a raw public/private keys

usign the same two raw keys from the 'export' section `/tmp/ecc_1_public.pem`, `/tmp/ecc_1_private.pem`

```bash
$ go run ecc/import/public/main.go -keyFile /tmp/ecc_1_public.pem
{
 "primaryKeyId": 1957864605,
 "key": [
  {
   "keyData": {
    "typeUrl": "type.googleapis.com/google.crypto.tink.EcdsaPublicKey",
    "value": "EgYIAxACGAIaIQAqJE1TqcfKrn3Es/eCQdalJSFIx9HJTxycMNpcYkUNZyIhAELaPVNbaDccW5TMimhArf6Sx2YBGLP72zHdinhne9gV",
    "keyMaterialType": "ASYMMETRIC_PUBLIC"
   },
   "status": "ENABLED",
   "keyId": 1957864605,
   "outputPrefixType": "TINK"
  }
 ]
}

$ go run ecc/import/private/main.go -keyFile /tmp/ecc_1_private.pem

{
  "primaryKeyId": 1957864605,
  "key": [
    {
      "keyData": {
        "typeUrl": "type.googleapis.com/google.crypto.tink.EcdsaPrivateKey",
        "value": "Ek4SBggDEAIYAhohACokTVOpx8qufcSz94JB1qUlIUjH0clPHJww2lxiRQ1nIiEAQto9U1toNxxblMyKaECt/pLHZgEYs/vbMd2KeGd72BUaIQAheR1xK57P0TVda5F2SSgfISoXegEH/vUm8UePBmixdg==",
        "keyMaterialType": "ASYMMETRIC_PRIVATE"
      },
      "status": "ENABLED",
      "keyId": 1957864605,
      "outputPrefixType": "TINK"
    }
  ]
}
```

---

### Encrypted KeySet

To test encrypted keysets, you need to have access to a KMS and have to create new keysets from scratch (since they're KMS encrypted with your key)

```bash
$ export PROJECT_ID=`gcloud config get-value core/project`
$ gcloud kms keyrings create kr1 --location=global
$ gcloud kms keys create --keyring=kr1 --location=global --purpose=encryption  k1

$ gcloud auth application-default login

$ export MASTERKEY="gcp-kms://projects/$PROJECT_ID/locations/global/keyRings/kr1/cryptoKeys/k1"

# $ tinkey create-keyset --master-key-uri=$MASTERKEY --key-template=AES256_GCM --out-format=binary --out=/tmp/aes_gcm_1_kms.bin

$ go run aes_gcm/export/encryptedkeyset/main.go --encrypted-key-set /tmp/aes_gcm_1_kms.bin --master-key-uri=$MASTERKEY
```

### Extract CipherText

If you use TINK to encrypt any data, then the ciphertext can have various prefixes added in by Tink.  Which means even with the raw key, the ciphertext wont decrypt.  These prefixes are descried in [TINK wire format prefixes](https://developers.google.com/tink/wire-format)

This library will detect the output type declared in the keyset, then remove the prefix value if `outputPrefix=TINK` was set using the primary KEYID so you can decrypt easily.   

For an end-to-end example with AESGCM, see [example/aes_gcm/export/main.go](example/aes_gcm/export/main.go)


---

### Library Export Functions

This library supports the following methods

The key types supported are:

* `ExportAesGcmKey()`

  Extract the raw AES-GCM key from the keyset.  You can use this key to decrypt/encrypt data using standard google AES library

* `ExportAesSivKey()`

   Extract the raw AES-SIV key from the keyset.  You can use this key to decrypt/encrypt data using standard google AES library

* `ExportAesCtrHmacAeadKey()`

   Extract the raw AES and HMAC key from the keyset.  Using off the shelf libraries requires reversing [this](https://developers.google.com/tink/streaming-aead/aes_ctr_hmac_streaming) process.

* `ExportRsaSsaPkcs1PrivateKey()`

   Extract the RSA Private key from the keyset as DER bytes.

* `ExportRsaSsaPkcs1PublicKey()`

   Extract the RSA Public key from the keyset as DER bytes.

* `ExportEcdsaPrivateKey()`

   Extract the ECC Private key from the keyset as DER bytes.

* `ExportEcdsaPublicKey()`
  
   Extract the ECC Public key from the keyset as DER bytes.

* `ExportHMACKey()`
  
   Extract the HMAC the keyset.

To process TINK encoded ciphertext or data

* `ExportCipherText()`

  Returns the ciphertext or signature without the TINK prefix values.

  You can use this output with off the shelf crypto libraries to decrypt or verify.

### Library Import Functions

* `ImportSymmetricKey()`

  Supply the raw aes key, the keyID to use and the output prefix to apply for this keyset

  If an external KMS KEK is provided, the output will be an encryptedKeySet

* `ImportHMACKey()`

   Import an external HMAC key into a tink keyset

* `ImportPublicKey()`

  Import an external RSA or ECC Public Key into a keyset

* `ImportPrivateKey()`

   Import an external RSA or ECC Private Key into a keyset
   

see the [example/](example/) folder for details

---

